set verbose off
set R_functions on

foreign language=R
Corrplot_R <- function(M, method, monochrome, cmin, cmax, fontsize, fname) {
  
  # URL: https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html
  pkgTest("corrplot")
  library(corrplot)
  
  #dev.off()	# avoid permante flashing-up when using gretl
  png(filename=fname, type="cairo", width=600, height=600, pointsize=fontsize, bg=NA, res=96)
  if (monochrome==0) {
    corrplot(M, method=method, cl.lim=c(cmin,cmax)) # ,col = gray.colors(10))
  }
  if (monochrome!=0) {
    corrplot(M, method=method, cl.lim=c(cmin,cmax), col = gray.colors(100)) # ,col = gray.colors(10))
  }
  dev.off()
  0
 }

  Corrplot_R1 <- function(M, method, fname) {
    # package Cairo 1.5-9 (2015-09-26)
    library(Cairo)
	library(corrplot)

    #dev.off()
    # dimensions in pixels
    CairoPNG(filename=fname, width=600, height=600, pointsize=14)
	corrplot(M, method=method)
    dev.off()
    0
  }
	
	# check whether corrplot pckg. is already installed
	pkgTest <- function(x) {
    	if (!require(x,character.only = TRUE))
    	{
      	install.packages(x,dep=TRUE)
        if (!require(x,character.only = TRUE)) stop("Package not found")
    	}
  	}

end foreign

/*
# example call
clear
matrix M = mnormal(200, 8)
M = mcorr(M)

string fname = sprintf("%s/Corrplot_R.png", $workdir)
#Select a method:
#-----------------
# "circle"
# "square"
# "ellipse"
# "number"
# "shade"
# "color"
# "pie"

scalar cmin = -1
scalar cmax = 1
scalar fs = 12
scalar monochrome = 0	# 0=colored, 1=monochrome
rret = R.Corrplot_R(M, "color", monochrome, cmin, cmax, fs, fname) 	# standard plot())
#rret = R.Corrplot_R1(M, "color", cmin, cmax, fname) 	# Cairo
*/
